{% extends "base.html" %}

{% block title %}Мои задачи{% endblock %}

{% block content %}

<section class="dashboard-grid">
  <!-- Левая колонка: добавление + команды -->
  <div class="panel">
    <h2 class="panel-title">Добавить задачу</h2>
    <p class="panel-subtitle">
      Задача сразу появится и в боте, и на этом экране.
    </p>

    <form method="post" action="/tasks/add" class="form-vertical">
      <input type="hidden" name="token" value="{{ token }}" />

      <label class="field-label">
        Текст задачи
        <input
          type="text"
          name="text"
          placeholder="Например: Сдать отчёт по практике"
          required
          autocomplete="off"
        />
      </label>

      <button type="submit" class="btn btn-primary">Добавить</button>
    </form>
  </div>

  <!-- Правая колонка: мини-справка -->
  <div class="panel">
    <h2 class="panel-title">Команды бота</h2>
    <ul class="help-list">
      <li><code>/start</code> — главное меню.</li>
      <li><code>/help</code> — список команд.</li>
      <li><code>/add</code> — добавить задачу.</li>
      <li><code>/list</code> — список задач.</li>
      <li><code>/site</code> — открыть это мини-приложение.</li>
    </div>
  </ul>
</section>

<section class="panel panel-full">
  <div class="panel-header">
    <div>
      <h2 class="panel-title">Список задач</h2>
      <p class="panel-subtitle">
        Все задачи для пользователя <code>{{ user_id }}</code>.
      </p>
    </div>

    <div class="tasks-toolbar">
      {% if delete_mode %}
        <span class="badge badge-red">Режим удаления</span>
        <a href="/?token={{ token }}" class="btn btn-ghost">Выйти</a>
      {% else %}
        <a
          href="/?token={{ token }}&mode=delete"
          class="btn btn-ghost"
        >Режим удаления</a>
      {% endif %}
    </div>
  </div>

  {% if tasks %}
    <ul class="tasks-list">
      {% for t in tasks %}
        <li class="task {% if t.is_done %}task-done{% endif %}">
          <div class="task-main">
            <div class="task-title-row">
              <span class="task-status-dot {% if t.is_done %}done{% endif %}"></span>
              <a
                href="/tasks/{{ t.id }}?token={{ token }}"
                class="task-text-link"
              >
                {{ t.text }}
              </a>
            </div>
            <div class="task-meta">
              <span>Создано: {{ t.created_at_fmt }}</span>
              <span>Дедлайн: {{ t.due_at_fmt }}</span>
            </div>
          </div>

          <div class="task-actions">
            {% if not delete_mode %}
              <form method="post" action="/tasks/{{ t.id }}/toggle">
                <input type="hidden" name="token" value="{{ token }}" />
                <button type="submit" class="btn btn-small">
                  {% if t.is_done %}Вернуть в работу{% else %}Готово{% endif %}
                </button>
              </form>
            {% endif %}
            <form method="post" action="/tasks/{{ t.id }}/delete">
              <input type="hidden" name="token" value="{{ token }}" />
              <button type="submit" class="btn btn-small btn-danger">
                Удалить
              </button>
            </form>
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="empty-text">
      Пока нет задач. Добавь первую в форме сверху.
    </p>
  {% endif %}
</section>

{% endblock %}
